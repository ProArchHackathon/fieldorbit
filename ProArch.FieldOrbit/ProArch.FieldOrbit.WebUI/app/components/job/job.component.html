<form name="jobDetailsForm" class="scrollable-form" (submit)="onSubmit()" [formGroup]="jobDetailsForm" novalidate>

    <md-card>
        <md-card-title><b>{{Button}} Job</b></md-card-title>
        <div class="padder">

            <md-form-field *ngIf="job.JobId" class="example-full-width">
                <input mdInput disabled required [(ngModel)]="job.JobId" name="JobId" placeholder="Job Id">
            </md-form-field>

            <md-form-field class="example-full-width">
                <input mdInput required [(ngModel)]="job.ServiceRequest.ServiceRequestId" autofocus name="ServiceRequestId" placeholder="Service Request Id" formControlName="serviceRequestId">
                <md-error *ngIf="jobDetailsForm.hasError('pattern', 'serviceRequestId')">
                        Please enter a valid Service Request Id
                </md-error>
                <md-error *ngIf="jobDetailsForm.hasError('maxLength','serviceRequestId')">
                        Max length exceeded
                </md-error>
                <md-error *ngIf="jobDetailsForm.hasError('required','serviceRequestId')">
                        Service Request Id is <strong>required</strong>
                </md-error>
            </md-form-field>

            <button class="mat-button mat-primary" md-raised-button type="button" (click)="getServiceRequest()">Get</button>
            <span style="color:red" *ngIf="serviceRequestError">{{serviceRequestError}}</span>
        </div>

        <div class="padder">

            <md-form-field class="example-full-width">
                <input mdInput [mdDatepicker]="startDate" [(ngModel)]="job.StartTime" [min]="minDate" (blur)="validateDate()" name="StartTime" placeholder="Start Date" formControlName="startDate">
                <md-datepicker-toggle mdSuffix [for]="startDate"></md-datepicker-toggle>
                <md-datepicker #startDate></md-datepicker>
                <md-error *ngIf="jobDetailsForm.hasError('required','startDate')">
                        Start Date is <strong>required</strong>
                </md-error>
            </md-form-field>
            
            <md-form-field class="example-full-width">
                <input mdInput [mdDatepicker]="endDate" [(ngModel)]="job.EndTime" [min]="minDate" name="EndDate" (blur)="validateDate()" placeholder="End Date" formControlName="endDate">
                <md-datepicker-toggle mdSuffix [for]="endDate"></md-datepicker-toggle>
                <md-datepicker #endDate></md-datepicker>
                <md-error *ngIf="jobDetailsForm.hasError('required','endDate')">
                        End Date is <strong>required</strong>
                </md-error>
            </md-form-field>
        </div>

        <div class="padder">
            <md-select placeholder="Status" [(ngModel)]="job.Status" formControlName="status">
                <md-option *ngFor="let statusValue of Statuses" [value]="statusValue.value">
                    {{ statusValue.viewValue }}
                </md-option>
            </md-select>

            <md-select placeholder="Priority" [(ngModel)]="job.Priority" formControlName="priority">
                <md-option *ngFor="let priorValue of Priorities" [value]="priorValue.value">
                    {{ priorValue.viewValue }}
                </md-option> 
            </md-select> 

        </div>
        <div class="padder">
            <md-form-field class="example-full-width">
                <textarea mdInput [(ngModel)]="job.JobDescription" name="JobDescription" placeholder="Job Description" formControlName="jobDescription"></textarea>
                <md-error *ngIf="jobDetailsForm.hasError('required','jobDescription')">
                        Description is <strong>required</strong>
                </md-error>
            </md-form-field>
            
            <md-form-field class="example-full-width">
                <textarea mdInput [(ngModel)]="job.Comments" name="Comments" placeholder="Comments" [ngModelOptions]="{standalone: true}"></textarea>
            </md-form-field>

            <md-form-field class="example-full-width">
                <textarea mdInput [(ngModel)]="job.Observations" name="Observations" placeholder="Observations" [ngModelOptions]="{standalone: true}"></textarea>
            </md-form-field>
        </div>
        <br />
        <p style="text-align: right">
            <span style="color:red" *ngIf="ErrorMessage">{{ErrorMessage}}</span>
            <button class="mat-button mat-primary" type="reset" md-primary-button md-raised-button (click)="resetDetails()">Reset</button>
            <button *ngIf="showButton" class="mat-button mat-primary" md-raised-button type="submit">{{Button}}</button>
        </p>
    </md-card>
    <md-card>
        <table class="table" style="width:100%;cursor:pointer;">
            <tr>
                <th>Service Request Id</th>
                <th>Job Description</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Status</th>
                <th>Priority</th>
            </tr>
            <tr *ngIf="failedToLoad;else jobsListTable">
                <td colspan="6">
                    <h3>Failed to load jobs details</h3>
                </td>
            </tr>
            <tr *ngFor="let sr of jobList" (click)="onSelectedRow(sr)" #jobsListTable>
                <td>{{sr.ServiceRequest.ServiceRequestId }} </td>
                <td>{{sr.JobDescription}} </td>
                <td>{{sr.StartTime}} </td>
                <td>{{sr.EndTime}} </td>
                <td>{{sr.Status}} </td>
                <td>{{sr.Priority}} </td>
            </tr>
        </table>
    </md-card>

</form>